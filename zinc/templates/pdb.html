{% extends "base.html" %}

{% block title %}{{ pdb.id }}{% endblock %}

{% block main %}
<div class="column-container">
    <h1>{{ pdb.title }}</h1>

    {% include "pdb-info.html" %}

    <div id="pdb-chains" class="pdb-box">
        <div>
            {{ pdb.chain_set.count }} zinc-bearing chain{{ pdb.chain_set.count|pluralize }}
            ({% for chain in pdb.chain_set.all %}{{ chain.chain_pdb_identifier }}{% if not forloop.last %}, {% endif %}{% endfor %});
            {{ pdb.metals.count }} zinc atom{{ pdb.metals.count|pluralize }}
            ({% for metal in pdb.metals %}{{ metal.atom_pdb_identifier }}{% if not forloop.last %}, {% endif %}{% endfor %});

        </div>
    </div>

    <div id="pdb-sites" class="pdb-box">
        <div class="pdb-sites-count">{{ pdb.zincsite_set.count }} zinc binding site{% if pdb.zincsite_set.count != 1 %}s{% endif %}</div>

        <div class="pdb-sites-list">
            {% for site in pdb.zincsite_set.all %}
            <div class="pdb-site"><a href="/{{ site.id }}/">
                <div class="pdb-site-id">{{ site.id }}</div>
                <div class="pdb-site-residues">
                    {{ site.residue_set.count }} residue{% if pdb.residue_set.count != 1 %}s{% endif %}
                    {% for residue in site.residue_set.all %}
                    <span class="pdb-site-residue">{{residue.chain.chain_pdb_identifier }}{{ residue.residue_pdb_identifier }}{{residue.chain.insertion_pdb_identifier }} ({{ residue.name }}){% if not forloop.last %}, {% endif %}</span>
                    {% endfor %}
                </div>
            </a></div>
            {% endfor %}
        </div>
    </div>

    {% include "ngl-pdb.html" %}
</div>

{% endblock %}

{% block endjs %}
    <script src="https://cdn.rawgit.com/arose/ngl/v0.10.4-1/dist/ngl.js"></script>
    <script src="/static/js/ngl.js"></script>
    <script>drawWholePdb("{{ pdb.id }}", "{{ pdb.ngl_metals_sele }}", "{{ pdb.ngl_residues_sele }}"); setUpControls();</script>
{% endblock %}
