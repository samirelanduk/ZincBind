{% extends "base.html" %}

{% block title %}Search Results: {{ request.GET.q }}{% endblock %}

{% block main %}
<script src="https://s3.eu-central-1.amazonaws.com/cdn.bio.sh/msa/latest/msa.min.gz.js"></script>
{% if results.count %}
    <div class="search-info">
        <div>{{ results.count }} result{% if results.count != 1 %}s{% endif %}</div>
        {% if results.num_pages > 1 %}<div>Page {{ page.number }} of {{ results.num_pages }}</div>{% endif %}
    </div>

    {% for object in page %}
    <div class="search-result">
        {% if chains %}
        <div class="pdb-result">
            <div class="pdb-result-main">
                <div class="pdb-code">Chain {{ object.chain_pdb_identifier }} ({{ object.pdb.id }})</div>
                <div class="pdb-deposited">Score: {{ object.blast_data.score }}</div>
                <div class="pdb-species">E-value: {{ object.blast_data.evalue }}</div>
                <div class="pdb-deposited">{{ object.pdb.title }}</div>
            </div>
        </div>
        {% else %}
        <div class="pdb-result"><a href="/pdbs/{{ object.id }}/">
            <div class="pdb-result-main">
                <div class="pdb-code">PDB: {{ object.id }}</div>
                <div class="pdb-deposited">{{ object.deposited }}</div>
                <div class="pdb-species"><script>document.write(formatSpecies("{{ object.organism }}"));</script></div>
            </div>
            <div class="pdb-title">{{ object.title|truncatewords:20 }}</div>
            <div class="pdb-secondary">
                 {{ object.classification}} |
                 {{ object.technique }}{% if object.resolution %} ({{ object.resolution }} Ã…){% endif %} |
                 {{ object.chain_set.count }} zinc-bearing chain{% if object.chain_set.count != 1 %}s{% endif %}
             </div>
        </a></div>
        {% endif %}

        <div class="site-results">
            {% if chains %}
            {% for site in object.zincsites %}
            {% include "zinc-site-summary.html" %}
            {% endfor %}
            {% else %}
            {% for site in object.zincsite_set.all %}
            {% include "zinc-site-summary.html" %}
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endfor %}

    {% if results.num_pages > 1 %}
        <div id="search-nav">
            {% if page.has_previous %}<a class="previous-page" href="/search?q={{ request.GET.q }}&page={{ page.previous_page_number}}">Previous Page</a>{% endif %}
            {% if page.has_next %}<a class="next-page" href="/search?q={{ request.GET.q }}&page={{ page.next_page_number}}">Next Page</a>{% endif %}
        </div>
    {% endif %}
{% else %}

    <div class="search-info no-results">
        <div>There were no results matching your query.</div>
        <div class="search-help">
            Search is case-insensitive, and searches PDB codes (for exact matches)
            and PDB descriptions, classifications, organisms, and experimental
            techniques (for partial matches).
        </div>
    </div>
{% endif %}
{% endblock %}
