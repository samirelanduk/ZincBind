{% extends "base.html" %}
{% load humanize %}

{% block title %}{{ site.id }}{% endblock %}

{% block css %}
 <link rel="stylesheet" type="text/css" href="/static/css/site.css">
{% endblock %}

{% block h1 %}<h1>Zinc Site: {{ site.id }}</h1>{% endblock %}
{% block main %}

<div id="site">
    <div class="row">
        <div class="half-width left">
            <div id="ngl-container">
              <iframe scrolling="no" src="/ngl/{{site.id}}/"></iframe>
            </div>
        </div><div class="half-width right">
          <table class="site-info">
              <tr>
                  <td>Residues</td>
                  <td>{% for residue in site.residue_set.all %}<div class="residue">
                        <strong>{{ residue.full_name }}</strong> ({{ residue.residue_id }})
                        <ul>
                          <li>CA distance: {% if residue.ca %}
                          {{ residue.ca.zinc_distance|floatformat:"2" }} &#8491;{% else %}N/A{% endif %}</li>
                          <li>CB distance: {% if residue.cb %}
                          {{ residue.cb.zinc_distance|floatformat:"2" }} &#8491;{% else %}N/A{% endif %}</li>
                        </ul><br></div>
                      {% endfor %}</td>
              </tr>
              <tr>
                  <td>PyMol Selector</td>
                  <td><code>sele {{ site.id }}, {% for residue in site.residue_set.all %}(chain {{ residue.chain }} and resi {{ residue.number_id }}) + {% endfor %} (chain {{ site.chain }} and resi {{ site.number_id }})</code></td>
              </tr>
              <tr>
                  <td>VMD Selector</td>
                  <td><code>{% for residue in site.residue_set.all %}(chain {{ residue.chain }} and resid {{ residue.number_id }}) or {% endfor %} (chain {{ site.chain }} and resid {{ site.number_id }})</code></td>
              </tr>
          </table>
        </div>
    </div>
</div>

<div id="site-pdb">
  <div class="row">
    <div class="half-width left">
      <table>
        <tr><td>PDB Code</td><td><a href="http://www.rcsb.org/pdb/explore.do?structureId={{ site.pdb.id }}" target="_blank">{{ site.pdb.id }}</td></tr>
        <tr><td>Deposition Date</td><td>{{ site.pdb.deposited|date:"j F, Y" }}</td></tr>
        <tr><td>Title</td><td>{{ site.pdb.title }}</td></tr>
        <tr><td>Technique</td><td>{{ site.pdb.technique }}</td></tr>
        <tr><td>Resolution</td><td>{{ site.pdb.resolution }}</td></tr>
        <tr><td>Rfactor</td><td>{{ site.pdb.rfactor }}</td></tr>
        <tr><td>Classification</td><td>{{ site.pdb.classification }}</td></tr>
        <tr><td>Source Organism</td><td>
          <em><script>document.write(formatSpecies("{{ site.pdb.organism }}"));</script></em>
        </td></tr>
        <tr><td>Expression System</td><td>
          <em><script>document.write(formatSpecies("{{ site.pdb.expression }}"));</script></em>
        </td></tr>
      </table>
  </div><div class="half-width right">
      <table class="other-sites">
        <tr>
          <th>Other Sites in this PDB</th>
        </tr>
        {% if pdb_sites.count == 0 %}
          <tr><td><em>None</em></td></tr>
        {% endif %}
        {% if pdb_sites.count <= 3 %}
          {% for site in pdb_sites %}
          <tr><td><a href="/{{ site.id }}/">{{ site.id }}</a></td></tr>
          {% endfor %}
        {% else %}
          <tr><td><a href="/{{ pdb_sites.0.id }}/">{{ pdb_sites.0.id }}</a></td></tr>
          <tr><td><a href="/{{ pdb_sites.1.id }}/">{{ pdb_sites.1.id }}</a></td></tr>
          <tr><td><a href="/search?code={{ site.pdb.id }}">See all {{ pdb_sites.count|add:"1"|intcomma }} zinc sites in this PDB</a></td></tr>
        {% endif %}
      </table>
      <table class="other-sites">
        <tr>
          <th>Other Sites from this Organism</th>
        </tr>
        {% if species_sites.count == 0 %}
          <tr><td><em>None</em></td></tr>
        {% endif %}
        {% if species_sites.count <= 3 %}
          {% for site in species_sites %}
          <tr><td><a href="/{{ site.id }}/">{{ site.id }}</a></td></tr>
          {% endfor %}
        {% elif species_sites.count == 0 %}
          <tr><td><em>None</em></td></tr>
        {% else %}
          <tr><td><a href="/{{ species_sites.0.id }}/">{{ species_sites.0.id }}</a></td></tr>
          <tr><td><a href="/{{ species_sites.1.id }}/">{{ species_sites.1.id }}</a></td></tr>
          <tr><td><a href="/search?organism={{ site.pdb.organism|urlencode }}">See all {{ species_sites.count|add:"1"|intcomma }} zinc sites in this Organism</a></td></tr>
        {% endif %}
      </table>
    </div>
  </div>
</div>
{% endblock %}
