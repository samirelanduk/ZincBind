{% extends "base.html" %}

{% block title %}{{ pdb.id }}{% endblock %}

{% block main %}
<div class="non-grid-column-container">
    <h1>{{ pdb.title }}</h1>

    {% include "pdb-info.html" %}

    <div id="pdb-chains" class="box">
        <div class="chains">
            <h3>Zinc-Bearing Chains in PDB</h3>
            <div class="count">{{ pdb.chain_set.count }} zinc-bearing chain{{ pdb.chain_set.count|pluralize }}</div>
            {% for chain in pdb.chain_set.all %}
                <div class="chain">Chain {{ chain.chain_pdb_identifier }} ({{ chain.sequence|length }} residues;  {{ chain.zincsites|length }} zinc binding site{{ chain.zincsites|length|pluralize }}; {% if chain.spacers %}Spacers: {{ chain.spacers }} {% endif %})</div>
                <div class="sequence">{{ chain.sequence }}</div>
            {% endfor %}
        </div>
        <div class="metals">
            <h3>Zinc atoms identified in PDB</h3>
            <div class="count">{{ pdb.metal_set.count }} zinc atom{{ pdb.metal_set.count|pluralize }}</div>
            ({% for metal in pdb.metal_set.all %}{{ metal.chain_pdb_identifier }}:{{ metal.residue_pdb_identifier }}{% if not forloop.last %}, {% endif %}{% endfor %})

            {% if pdb.omitted_metals.count %}
            <div class="omitted">
                <h3>Zinc atoms not used</h3>
                {% for metal in pdb.omitted_metals %}<div><strong>{{ metal.chain_pdb_identifier }}:{{ metal.residue_pdb_identifier }}</strong>: {{ metal.omission }}</div>{% endfor %}
            </div>
            {% endif %}

        </div>
    </div>

    <div id="pdb-sites" class="box">
        <div class="pdb-sites-count">{{ pdb.zincsite_set.count }} zinc binding site{% if pdb.zincsite_set.count != 1 %}s{% endif %}</div>

        {% if pdb.zincsite_set.count %}
            <div class="pdb-sites-list">
                {% for site in pdb.zincsite_set.all %}
                {% include "zinc-site-summary.html" %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    {% include "ngl-pdb.html" %}
</div>

{% endblock %}

{% block endjs %}
    <script src="/static/js/ngl-source.js"></script>
    <script src="/static/js/ngl.js"></script>
    <script>
    var bonds = [];
    {% for site in pdb.zincsite_set.all %}
        {% for metal in site.metal_set.all %}
            {% for bond in metal.coordinatebond_set.all %}
            bond = [];
            bond.push([{{ metal.x }}, {{ metal.y }}, {{ metal.z }}]);
            bond.push([{{ bond.atom.x }}, {{ bond.atom.y }}, {{ bond.atom.z }}]);
            bonds.push(bond)
            {% endfor %}
        {% endfor %}
    {% endfor %}
    drawNgl("{{ pdb.id }}", "{{ pdb.assembly }}", "{{ pdb.ngl_metals_sele|safe }}", "{{ pdb.ngl_residues_sele|safe }}", bonds, false); setUpControls();</script>
{% endblock %}
